<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Kryptik Malware Analysis</title>

	<!-- BootstrapCDN -- >
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

	<!-- jQuery library -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

	<!-- Latest compiled JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

	<!-- Google Fonts -->
  	<link href="https://fonts.googleapis.com/css?family=Droid+Sans+Mono|Inconsolata" rel="stylesheet">

  	<!-- style sheet -->
	<link rel="stylesheet" type="text/css" href="/css/style.css">

	<!--Google Analytics -->
	<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-52352656-1', 'auto');
	ga('send', 'pageview');
	</script>

	<!--Prism Theme-->
	<link href="/themes/prism.css" rel="stylesheet" />
</head>

<body>
<!-- Prism JS -->
	<script src="/js/prism.js"></script>

	<div class="jumbotron text-center">
	  <h1>Kryptik</h1>
	  <p>Malware Analysis</p>
	  <p>July 22nd, 2019</p>
	</div>

	<div class="container">
	  <div class="row">
	    <div class="col-sm-12">
	    <a href="https://jessecbrown.com"><----Back to jessecbrown.com</a>
	      <h3>Abstract</h3>
	      <p>Recently I was analyzing an interesting Kryptik sample and realized there aren't very many detailed analysis's of this malware family.
			The sample I came across seems fairly straight-forward and has some unique characteristics. What follows is my attempt and providing some analysis for the community. </p>
			<br>
			<p>This malware family is identified by Microsoft Defender as <a href="https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Trojan:Win32/Kryptik&ThreatID=2147727763"></a>Trojan:Win32/Kryptik</a>. At the time of this writing Defender was correctly identifying this sample. </p>
			<br>
			<p>I've tried to structure this write-up around <a href="https://attack.mitre.org/matrices/enterprise/">MITRE's ATTACK framework</a> and provide links to Red Canary's <a href="https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/index.md">Atomic Red Team</a> tests to show defenders how they can detect the TTPs.</p>
			<br>
			<h3>Initial Access</h3>
				<p>Initial access is achieved through a <a href="https://attack.mitre.org/techniques/T1193/">spearphishing attachment (T1193)</a>. In this case a spoofed DHL shipping notification. With the attached maldoc <code>sp.doc</code>. </p>
				<br>
				<img src="/analysis/2019/07/kryptik/assets/Kryptikeml.png" alt="Kryptik Email PNG">
			<h3>Execution</h3>
			<p>Execution requires the victim to open the maldoc (sp.doc) in a vulnerable version of Microsoft Word. In particular, a version of Word's Equation Editor (eqnedt32.exe) vulnerable to <a href="">CVE-2017-11882</a>. 
			Versions of Microsoft Equation Editor prior to November 14th 2017 contain a stack buffer overflow vulnerability which will allow an adversary to execute remote code. Eqnedt32.exe does not make use of Data Execution Prevention (DEP) or Address Space Layout Randomization (ASLR).
			Microsoft patched this vulnerability and then later removed Equation Editor all together after (cve) was found. Initially it may seem odd for an adversary to use a 17 month old vulnerability, but it's worth noting that if a user did not opt into Office updates they would still have the vulnerable equation editor even with a default install of Office 2016. </p>
			<br>
			<p>What makes this exploit useful for an adversary is it only requires a victim to open the maldoc. The do not need to enable a macro or provide any other additional input.</p>
			<h3>Persistence</h3>
			<h3>Privilege Escalation</h3>
			<h3>Credential Access</h3>
			<h3>Discovery</h3>
			<h3>Lateral Movement</h3>
			<h3>Collection</h3>
			<h3>Command and Control</h3>
			<h3>Exfiltration</h3>
	      <br>
	      <!-- NMAP Code-->
			<pre><code class="language-none">
				code block.

			</code></pre>
	    </div>
	  </div>
	</div>

<footer style="width: 100%; text-align: center; padding-top: 25px; color: #98999E;">
	<div class="col-md-16 text-center">
		<a href="https://twitter.com/jessecarlbrown" class="twitter-follow-button" data-show-count="false">Follow @jessecarlbrown</a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
		<br>
		<br>
		<span>Copyright &copy; <script>new Date().getFullYear()>2010&&document.write(+new Date().getFullYear());</script>, Jesse Brown<span>
		</span></span></footer>
		<br>
		<br>

	</div>
</body>
</html>
